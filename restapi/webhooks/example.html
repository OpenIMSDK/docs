<!doctype html>
<html lang="en-GB" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-restapi docs-doc-id-webhooks/example">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">callback example | OpenIM Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://doc.rentsoft.cn/restapi/webhooks/example"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-restapi-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-restapi-current"><meta data-rh="true" property="og:title" content="callback example | OpenIM Docs"><meta data-rh="true" name="description" content="brief description"><meta data-rh="true" property="og:description" content="brief description"><link data-rh="true" rel="icon" href="/favicon.ico"><link data-rh="true" rel="canonical" href="https://doc.rentsoft.cn/restapi/webhooks/example"><link data-rh="true" rel="alternate" href="https://doc.rentsoft.cn/zh-Hans/restapi/webhooks/example" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://doc.rentsoft.cn/restapi/webhooks/example" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://doc.rentsoft.cn/restapi/webhooks/example" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://NRY7H605ZD-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-5FDFFSS",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>


<link rel="search" type="application/opensearchdescription+xml" title="OpenIM Docs" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.c2eae4fa.css">
<link rel="preload" href="/assets/js/runtime~main.bdc26ab3.js" as="script">
<link rel="preload" href="/assets/js/main.183d0c50.js" as="script">
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5FDFFSS" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/logo/light.png" alt="OpenIM Docs" class="themedImage_ToTc themedImage--light_HNdA logo-icon" width="107.5px"><img src="/logo/dark.png" alt="OpenIM Docs" class="themedImage_ToTc themedImage--dark_i4oU logo-icon" width="107.5px"></div></a><a class="navbar__item navbar__link" href="/guides/introduction">Guides</a><a class="navbar__item navbar__link" href="/sdks/introduction">Client SDKs</a><a class="navbar__item navbar__link" href="/restapi/introduction">Server APIs</a></div><div class="navbar__items navbar__items--right"><div class="searchBox_ZlJk"><div class="relative flex items-center gap-2"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search" id="search-bar"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><a href="https://github.com/OpenIMSDK" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link dev-portal-signup dev-portal-link header-github-link">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/zh-Hans/restapi/webhooks/example" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-Hans">简体中文</a></li><li><a href="/restapi/webhooks/example" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en-GB">English</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_mhZE"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/restapi/introduction">Callback Explanation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/restapi/apis/userManagement/userRegister">REST API</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/restapi/webhooks/introduction">Webhooks</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/restapi/webhooks/introduction">Callback Description</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/restapi/webhooks/example">callback example</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/restapi/webhooks/group/applyJoinGroupBefore">Group-related </a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/restapi/webhooks/msg/msgModify">Message-related </a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/restapi/webhooks/push/offlinePushBefore">Push-related </a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/restapi/webhooks/relationship/addBlack">Relationship-related </a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/restapi/webhooks/user/updateUserInfoAfter">User-related </a></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/restapi/commonFields">Common Struct Descriptions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/restapi/contentDescription">Message Detailed Type Description Document</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/restapi/errCode">Error Codes</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h3 class="anchor anchorWithStickyNavbar_LWe7" id="brief-description"><strong>brief description</strong><a href="#brief-description" class="hash-link" aria-label="Direct link to brief-description" title="Direct link to brief-description">​</a></h3><p>Use callback to realize the customer service robot question and answer function, send a message to the customer service robot (support to send text messages and image messages), the customer service robot to return this message.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-modify-the-configuration-file">Step 1 Modify the configuration file<a href="#step-1-modify-the-configuration-file" class="hash-link" aria-label="Direct link to Step 1 Modify the configuration file" title="Direct link to Step 1 Modify the configuration file">​</a></h3><p>Modify the config/config.yaml configuration in open-im-server by referring to the following template</p><p><img loading="lazy" alt="PC Web Interface" src="/assets/images/config-c8a51d2b07b4a2f6fc5256170d63bf13.png" width="349" height="271" class="img_ev3q"></p><p>tips</p><blockquote><p>url is callback url</p></blockquote><blockquote><p>If afterSendSingleMsg.enable is true, the callback is enabled.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-create-a-customer-service-robot-account-and-designate-it-as-a-default-friend">Step 2 Create a customer service robot account and designate it as a default friend<a href="#step-2-create-a-customer-service-robot-account-and-designate-it-as-a-default-friend" class="hash-link" aria-label="Direct link to Step 2 Create a customer service robot account and designate it as a default friend" title="Direct link to Step 2 Create a customer service robot account and designate it as a default friend">​</a></h3><ol><li><p>Create a customer service bot account and record the <strong>userID</strong> of the account</p></li><li><p>Log in to the admin backend and add the customer service bot account as a default friend
<img loading="lazy" alt="PC Web Interface" src="/assets/images/defaultFriend-51de9990f35a694d9f39c23a2f0124a3.png" width="1885" height="690" class="img_ev3q"></p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-write-the-aftersendsinglemsg-interface">Step 3 Write the <strong>afterSendSingleMsg</strong> interface<a href="#step-3-write-the-aftersendsinglemsg-interface" class="hash-link" aria-label="Direct link to step-3-write-the-aftersendsinglemsg-interface" title="Direct link to step-3-write-the-aftersendsinglemsg-interface">​</a></h3><p>Reference examples are as follows</p><p>tips:</p><blockquote><p>1、Replace <strong>robotics</strong> in the example with the userID obtained in step 2</p></blockquote><div class="language-Go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">func (m *ChatApi) CallbackExample(c *gin.Context) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // 1. Callback after sending a single chat message</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    var req apistruct.CallbackAfterSendSingleMsgReq</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    if err := c.BindJSON(&amp;req); err != nil {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        log.ZError(c, &quot;CallbackExample BindJSON failed&quot;, err)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        apiresp.GinError(c, errs.ErrArgs.WithDetail(err.Error()).Wrap())</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        return</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    resp := apistruct.CallbackAfterSendSingleMsgResp{</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        CommonCallbackResp: apistruct.CommonCallbackResp{</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            ActionCode: 0,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            ErrCode:    200,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            ErrMsg:     &quot;success&quot;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            ErrDlt:     &quot;successful&quot;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            NextCode:   0,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    c.JSON(http.StatusOK, resp)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // 2. If the user receiving the message is a customer service bot, return the message.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // UserID of the robot account</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    robotics:=&quot;robotics&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    if req.SendID == robotics || req.RecvID != robotics {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        return</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    if req.ContentType != constant.Picture &amp;&amp; req.ContentType != constant.Text {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        return</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // Administrator token</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    url := &quot;http://127.0.0.1:10009/account/login&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    adminID := config.Config.ChatAdmin[0].AdminID</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    paswd := md5.Sum([]byte(adminID))</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    admin_input := admin.LoginReq{</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        Account:  config.Config.ChatAdmin[0].AdminID,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        Password: hex.EncodeToString(paswd[:]),</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    header := make(map[string]string, 2)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    header[&quot;operationID&quot;] = &quot;111&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    b, err := Post(c, url, header, admin_input, 10)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    if err != nil {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        log.ZError(c, &quot;CallbackExample send message failed&quot;, err)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        apiresp.GinError(c, errs.ErrInternalServer.WithDetail(err.Error()).Wrap())</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        return</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    type TokenInfo struct {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        ErrCode int                      `json:&quot;errCode&quot;`</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        ErrMsg  string                   `json:&quot;errMsg&quot;`</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        ErrDlt  string                   `json:&quot;errDlt&quot;`</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        Data    apistruct.AdminLoginResp `json:&quot;data,omitempty&quot;`</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    admin_output := &amp;TokenInfo{}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    if err = json.Unmarshal(b, admin_output); err != nil {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        log.ZError(c, &quot;CallbackExample unmarshal failed&quot;, err)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        apiresp.GinError(c, errs.ErrInternalServer.WithDetail(err.Error()).Wrap())</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        return</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    header[&quot;token&quot;] = admin_output.Data.AdminToken</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    url = &quot;http://127.0.0.1:10008/user/find/public&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    search_input := chat.FindUserFullInfoReq{</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        UserIDs: []string{robotics},</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    b, err = Post(c, url, header, search_input, 10)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    if err != nil {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        log.ZError(c, &quot;CallbackExample unmarshal failed&quot;, err)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        apiresp.GinError(c, errs.ErrInternalServer.WithDetail(err.Error()).Wrap())</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        return</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    type UserInfo struct {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        ErrCode int                       `json:&quot;errCode&quot;`</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        ErrMsg  string                    `json:&quot;errMsg&quot;`</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        ErrDlt  string                    `json:&quot;errDlt&quot;`</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        Data    chat.FindUserFullInfoResp `json:&quot;data,omitempty&quot;`</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    search_output := &amp;UserInfo{}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    if err = json.Unmarshal(b, search_output); err != nil {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        log.ZError(c, &quot;search_output unmarshal failed&quot;, err)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        apiresp.GinError(c, errs.ErrInternalServer.WithDetail(err.Error()).Wrap())</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        return</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    if len(search_output.Data.Users) == 0 {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        apiresp.GinError(c, errs.ErrRecordNotFound.Wrap(&quot;the robotics not found&quot;))</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        return</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    log.ZDebug(c, &quot;callback&quot;, &quot;searchUserAccount&quot;, search_output)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    text := apistruct.TextElem{}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    picture := apistruct.PictureElem{}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    mapStruct := make(map[string]any)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // Processing text messages</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    if err != nil {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        log.ZError(c, &quot;CallbackExample get Sender failed&quot;, err)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        apiresp.GinError(c, errs.ErrInternalServer.WithDetail(err.Error()).Wrap())</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        return</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // Handle message structures</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    if req.ContentType == constant.Text {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        err = json.Unmarshal([]byte(req.Content), &amp;text)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        if err != nil {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            log.ZError(c, &quot;CallbackExample unmarshal failed&quot;, err)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            apiresp.GinError(c, errs.ErrInternalServer.WithDetail(err.Error()).Wrap())</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            return</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        log.ZDebug(c, &quot;callback&quot;, &quot;text&quot;, text)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        mapStruct[&quot;content&quot;] = text.Content</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        err = json.Unmarshal([]byte(req.Content), &amp;picture)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        if err != nil {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            log.ZError(c, &quot;CallbackExample unmarshal failed&quot;, err)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            apiresp.GinError(c, errs.ErrInternalServer.WithDetail(err.Error()).Wrap())</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            return</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        log.ZDebug(c, &quot;callback&quot;, &quot;text&quot;, picture)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        if strings.Contains(picture.SourcePicture.Type, &quot;/&quot;) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            arr := strings.Split(picture.SourcePicture.Type, &quot;/&quot;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            picture.SourcePicture.Type = arr[1]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        if strings.Contains(picture.BigPicture.Type, &quot;/&quot;) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            arr := strings.Split(picture.BigPicture.Type, &quot;/&quot;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            picture.BigPicture.Type = arr[1]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        if len(picture.SnapshotPicture.Type) == 0 {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            picture.SnapshotPicture.Type = picture.SourcePicture.Type</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        mapStructSnap := make(map[string]interface{})</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        if mapStructSnap, err = convertStructToMap(picture.SnapshotPicture); err != nil {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            log.ZError(c, &quot;CallbackExample struct to map failed&quot;, err)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            apiresp.GinError(c, err)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            return</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        mapStruct[&quot;snapshotPicture&quot;] = mapStructSnap</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        mapStructBig := make(map[string]interface{})</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        if mapStructBig, err = convertStructToMap(picture.BigPicture); err != nil {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            log.ZError(c, &quot;CallbackExample struct to map failed&quot;, err)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            apiresp.GinError(c, err)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            return</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        mapStruct[&quot;bigPicture&quot;] = mapStructBig</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        mapStructSource := make(map[string]interface{})</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        if mapStructSource, err = convertStructToMap(picture.SourcePicture); err != nil {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            log.ZError(c, &quot;CallbackExample struct to map failed&quot;, err)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            apiresp.GinError(c, err)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            return</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        mapStruct[&quot;sourcePicture&quot;] = mapStructSource</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        mapStruct[&quot;sourcePath&quot;] = picture.SourcePath</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    log.ZDebug(c, &quot;callback&quot;, &quot;mapStruct&quot;, mapStruct, &quot;mapStructSnap&quot;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    header[&quot;token&quot;] = admin_output.Data.ImToken</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    input := &amp;apistruct.SendMsgReq{</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        RecvID: req.SendID,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        SendMsg: apistruct.SendMsg{</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            SendID:           search_output.Data.Users[0].UserID,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            SenderNickname:   search_output.Data.Users[0].Nickname,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            SenderFaceURL:    search_output.Data.Users[0].FaceURL,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            SenderPlatformID: req.SenderPlatformID,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            Content:          mapStruct,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            ContentType:      req.ContentType,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            SessionType:      req.SessionType,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            SendTime:         utils.GetCurrentTimestampByMill(), // millisecond</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    url = &quot;http://127.0.0.1:10002/msg/send_msg&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    type sendResp struct {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        ErrCode int             `json:&quot;errCode&quot;`</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        ErrMsg  string          `json:&quot;errMsg&quot;`</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        ErrDlt  string          `json:&quot;errDlt&quot;`</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        Data    msg.SendMsgResp `json:&quot;data,omitempty&quot;`</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    output := &amp;sendResp{}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // Initiate a post request that calls the interface that sends the message (the bot sends a message to user)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    b, err = Post(c, url, header, input, 10)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    if err != nil {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        log.ZError(c, &quot;CallbackExample send message failed&quot;, err)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        apiresp.GinError(c, errs.ErrInternalServer.WithDetail(err.Error()).Wrap())</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        return</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    if err = json.Unmarshal(b, output); err != nil {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        log.ZError(c, &quot;CallbackExample unmarshal failed&quot;, err)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        apiresp.GinError(c, errs.ErrInternalServer.WithDetail(err.Error()).Wrap())</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        return</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    res := &amp;msg.SendMsgResp{</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        ServerMsgID: output.Data.ServerMsgID,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        ClientMsgID: output.Data.ClientMsgID,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        SendTime:    output.Data.SendTime,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    apiresp.GinSuccess(c, res)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// struct to map</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">func convertStructToMap(input interface{}) (map[string]interface{}, error) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    result := make(map[string]interface{})</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    inputType := reflect.TypeOf(input)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    inputValue := reflect.ValueOf(input)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    if inputType.Kind() != reflect.Struct {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        return nil, errs.ErrArgs.Wrap(&quot;input is not a struct&quot;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    for i := 0; i &lt; inputType.NumField(); i++ {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        field := inputType.Field(i)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        fieldValue := inputValue.Field(i)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        mapKey := field.Tag.Get(&quot;mapstructure&quot;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        fmt.Println(mapKey)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        if mapKey == &quot;&quot; {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            mapKey = field.Name</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        mapKey = strings.ToLower(mapKey)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        result[mapKey] = fieldValue.Interface()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    return result, nil</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// Send a POST request</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">func Post(ctx context.Context, url string, header map[string]string, data any, timeout int) (content []byte, err error) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    var (</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        // define http client.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        client = &amp;http.Client{</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            Timeout: 15 * time.Second, // max timeout is 15s</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    if timeout &gt; 0 {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        var cancel func()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        ctx, cancel = context.WithTimeout(ctx, time.Second*time.Duration(timeout))</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        defer cancel()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    jsonStr, err := json.Marshal(data)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    if err != nil {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        return nil, err</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    req, err := http.NewRequestWithContext(ctx, http.MethodPost, url, bytes.NewBuffer(jsonStr))</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    if err != nil {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        return nil, err</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    if operationID, _ := ctx.Value(constant.OperationID).(string); operationID != &quot;&quot; {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        req.Header.Set(constant.OperationID, operationID)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    for k, v := range header {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        req.Header.Set(k, v)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    req.Header.Add(&quot;content-type&quot;, &quot;application/json; charset=utf-8&quot;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    resp, err := client.Do(req)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    if err != nil {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        return nil, err</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    defer resp.Body.Close()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    result, err := io.ReadAll(resp.Body)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    if err != nil {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        return nil, err</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    return result, nil</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-4-experience-the-feature">Step 4 Experience the feature<a href="#step-4-experience-the-feature" class="hash-link" aria-label="Direct link to Step 4 Experience the feature" title="Direct link to Step 4 Experience the feature">​</a></h3><p>1、Successful login can send messages and pictures to the customer service robot account</p><p><img loading="lazy" alt="PC Web Interface" src="/assets/images/result-015cb7338598a6182110ee75ccdbb9e8.png" width="588" height="607" class="img_ev3q"></p><p>Help me translate the above document into English, and only need to reply with the translated text, and do not add unnecessary content before and after the reply.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/OpenIMSDK/docs/tree/main/docs/restapi/webhooks/example.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-01-22T11:49:33.000Z">Jan 22, 2024</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/restapi/webhooks/introduction"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Callback Description</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/restapi/webhooks/group/applyJoinGroupBefore"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Callback Before a User Joins a Group</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#brief-description" class="table-of-contents__link toc-highlight"><strong>brief description</strong></a></li><li><a href="#step-1-modify-the-configuration-file" class="table-of-contents__link toc-highlight">Step 1 Modify the configuration file</a></li><li><a href="#step-2-create-a-customer-service-robot-account-and-designate-it-as-a-default-friend" class="table-of-contents__link toc-highlight">Step 2 Create a customer service robot account and designate it as a default friend</a></li><li><a href="#step-3-write-the-aftersendsinglemsg-interface" class="table-of-contents__link toc-highlight">Step 3 Write the <strong>afterSendSingleMsg</strong> interface</a></li><li><a href="#step-4-experience-the-feature" class="table-of-contents__link toc-highlight">Step 4 Experience the feature</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container-fluid container"><div class="margin-bottom--sm"><a class="footerLogoLink_DDai" href="/"><img src="/logo/light.png" alt="OpenIM Docs" class="themedImage_ToTc themedImage--light_HNdA footer__logo" height="38px"><img src="/logo/dark.png" alt="OpenIM Docs" class="themedImage_ToTc themedImage--dark_i4oU footer__logo" height="38px"></a></div><p class="footer__description">OpenIM is an open source instant messaging component built by IM technical experts. OpenIM includes IM server and client SDK, which realizes important features such as high performance, light weight, and easy expansion. By integrating OpenIM components and privatizing the deployment of the server, developers can quickly integrate instant messaging and real-time network capabilities into their own applications, and ensure the security and privacy of business data.</p><div class="footer__row"><div class="footer__data"><div class="footer__cta"><p>Join the Slack channel to communicate and discuss with everyone!</p><a href="https://join.slack.com/t/openimsdk/shared_invite/zt-1tmoj26uf-_FDy3dowVHBiGvLk9e5Xkg" target="_blank" rel="noopener noreferrer">Join</a></div></div><div class="links"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Product</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://openim.io/commercial" target="_blank" rel="noopener noreferrer" class="footer__link-item">Business</a></li></ul></div><div class="col footer__col"><div class="footer__title">Company</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://openim.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">About Us</a></li><li class="footer__item"><a href="mailto:service@open-im.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contact Us</a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/guides/introduction">Documentation</a></li><li class="footer__item"><a href="https://join.slack.com/t/openimsdk/shared_invite/zt-1tmoj26uf-_FDy3dowVHBiGvLk9e5Xkg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Community</a></li></ul></div></div></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © OpenIM since 2023. All rights reserved.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.bdc26ab3.js"></script>
<script src="/assets/js/main.183d0c50.js"></script>
</body>
</html>