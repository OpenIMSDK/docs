---
title: 用户状态订阅或取消后的回调
hide_title: true
---

# 用户状态订阅或取消后的回调

## 功能说明
App 业务服务端可以通过此回调获取用户状态订阅或取消的请求信息。此回调使业务服务端能够监控和记录用户状态订阅或取消的操作。

## 注意事项
- 为启用回调，必须配置回调 URL，并开启本条回调协议对应的开关。配置方法详见 [回调说明](../introduction) 文档。
- 回调的方向是 OpenIMServer 向 App 后台发起 HTTP/HTTPS POST 请求。
- App 业务服务端在收到回调请求之后，需要校验请求 URL 中的 command 参数是否是自己的 SDKNAME 参数。
- APP 业务服务端需在超时时间内响应此请求。

## 可能触发该回调的场景
- App 用户通过客户端订阅或取消其他用户的状态。
- App 管理员通过 REST API 执行用户状态订阅或取消操作。

## 回调发生时机
- OpenIMServer 处理用户状态订阅或取消操作后。

## 接口说明

### 请求 URL 示例
以下示例中 App 配置的回调 URL 为 `https://callbackurl`。
```plaintext
https://callbackurl?sdkName=$SdkName&command=$CallbackCommand&contenttype=json
```

### 请求参数说明

| 参数                 | 说明                                                   |
|-------------------- |------------------------------------------------------ |
| https               | 请求协议为 HTTPS，请求方式为 POST                      |
| https://callbackurl | 回调 URL                                               |
| SdkName             | 创建应用时，在即时通信 IM 控制台分配的 SKDName        |
| CallbackCommand     | 固定值为：subscribeOrCancelUsersStatusAfterCommand    |
| contenttype         | 固定值为 JSON                                         |

### 请求包示例
```json
{
  "callbackCommand": "subscribeOrCancelUsersStatusAfterCommand",
  "userID": "user001",
  "userIDs": ["user002", "user003"],
  "genre": 1
}
```

### 请求包字段说明

| 字段    | 类型   | 描述                                    |
|---------|--------|---------------------------------------|
| callbackCommand         | string | 回调命令，这里是用户状态订阅或取消后的回调                            |
| userID  | string | 发起订阅或取消操作的用户ID               |
| userIDs | array  | 被订阅或取消状态的用户ID列表             |
| genre   | int32  | 操作类型，1表示订阅，0表示取消            |

## 应答包示例

### 操作成功
表示用户状态订阅或取消操作已成功处理。

```json
{
    "actionCode": 0,
    "errCode": 0,
    "errMsg": "Success",
    "errDlt": "",
    "nextCode": "0"
}
```

## 应答包字段说明

| 字段        | 值    | 说明                                      |
|------------|-------|-----------------------------------------|
| actionCode | 0     | 表示业务系统的回调是否正确执行。`0`表示操作成功。   |
| errCode    | int32 | 自定义错误码，用于详细指明错误类型。                |
| errMsg     | string| 自定义错误消息，提供简短的错误描述。               |
| errDlt     | string| 提供错误的详细描述。                            |
| nextCode   | string| 指示后续操作的代码，通常用于控制流程的分支。        |
