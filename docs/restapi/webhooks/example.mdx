---
sidebar_position: 2
title: 回调例子
hide_title: true
---

# 🛠 用 OpenIM 实现聊天机器人问答功能

### **简要描述**

使用 OpenIM 中的 callback 机制实现聊天机器人问答功能。给聊天机器人发送一条消息后（支持发送文本消息和图片消息），聊天机器人把这条消息返回。


## 1.修改配置文件
参照如下模板修改 open-im-server 中的 config/config.yaml 配置

![PC Web Interface](./assets/config.png)

tips
> url 为 回调 url

> afterSendSingleMsg.enable 为 true 时，开启该回调
 
## 2.创建聊天机器人账号并指定其为默认好友
1. 登录管理后台，在管理后台业务系统的用户管理中，创建聊天机器人账号，记录该账号的 **userID**

2. 在管理后台业务系统的注册管理中，将创建的聊天机器人账号添加为默认好友

Tips：
> 登录管理后台的账号密码: 

> 账号：chatAdmin 

> 密码：chatAdmin

## 3.编写 **afterSendSingleMsg** 接口
参考例子如下

tips:
>1、需要将例子中的 **robotics** 替换成 **2** 中获取的 **userID**


```Go
func (m *ChatApi) CallbackExample(c *gin.Context) {
	// 1. Handling callbacks after sending a single chat message
	msgInfo, err := handlingCallbackAfterSendMsg(c)
	if err != nil {
		apiresp.GinError(c, err)
		return
	}

	// 2. If the user receiving the message is a customer service bot, return the message.
	// 2.1 UserID of the robot account
	robotics := "robotics"

	// 2.2 ChatRobot account validation and determining if messages are text and images
	if msgInfo.SendID == robotics || msgInfo.RecvID != robotics {
		return
	}
	if msgInfo.ContentType != constant.Picture && msgInfo.ContentType != constant.Text {
		return
	}

	// 2.3 Get administrator token
	adminToken, err := getAdminToken(c)
	if err != nil {
		apiresp.GinError(c, err)
		return
	}

	// 2.4 Get RobotAccount info
	robUser, err := getRobotAccountInfo(c, adminToken.AdminToken, robotics)
	if err != nil {
		apiresp.GinError(c, err)
		return
	}

	// 2.5 Constructing Message Field Contents
	mapStruct, err := contextToMap(c, msgInfo)
	if err != nil {
		apiresp.GinError(c, err)
		return
	}

	// 2.6 Send Message
	err = sendMessage(c, adminToken.ImToken, robotics, msgInfo, robUser, mapStruct)
	if err != nil {
		apiresp.GinError(c, err)
		return
	}
}

```
详细代码参考
[链接](https://github.com/openimsdk/chat/blob/logs/example/callback/callback.go)

## 4.体验该功能
1、实现效果如下

![PC Web Interface](./assets/result.png)

