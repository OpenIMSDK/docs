---
title: '源码部署'
sidebar_position: 1
---

# 🛠 源码部署

##  1. 环境及组件要求
对于服务器环境、系统、以及存储组件可以参考[此文档](./env-comp)



---


## 2. 部署 OpenIM Server (IM)

### 2.1 📡 设置 OPENIM_IP

```jsx
# 如果服务器有外网IP
export OPENIM_IP="外网IP"
# 如果仅提供内网服务
export OPENIM_IP="内网IP"

```

### 2.2 🏗️ 部署组件 (mongodb/redis/zookeeper/kafka/MinIO等)

```
# 建议切换到release-v3.5及以后的release分支 
git clone https://github.com/OpenIMSDK/open-im-server && cd open-im-server && make init && docker compose up -d

```

### 2.3 🛠️ 编译

```
make build

```

### 2.4 🚀 启动/停止/检测

```jsx
# 启动
make start
# 停止
make stop
# 检测
make check

```

## 3. 部署 App Server (Chat)

### 3.1 🏗️ 部署组件（mysql）

```
#返回上一级目录
cd ..
# clone仓库 建议切换到release-v1.5及以后的release分支
git clone https://github.com/OpenIMSDK/chat chat && cd chat
# 部署mysql
docker run -d --name mysql2 -p 13306:3306 -p 33306:33060 -v "$(pwd)/components/mysql/data:/var/lib/mysql" -v "/etc/localtime:/etc/localtime" -e MYSQL_ROOT_PASSWORD="openIM123" --restart always mysql:5.7
```

### 3.2 🛠️ 编译

```
make init
make build
```

### 3.3 🚀 启动/停止/检测

```jsx
# 启动
make start
# 停止
make stop
# 检测
make check
```


## 4. 快速验证

请参考[快速验证](./quickTestServer)文档


## 5. 管理后台和监控系统

请参考 [管理后台和监控系统](./admin) 文档。



## 6. 关于配置项的修改

### 6.1 🛠️ 共用配置项的修改

| 配置项 | 需要修改的文件 | 操作 |
| --- | --- | --- |
| mongo/kafka/minio 相关 | .env, openim-server/config/config.yaml | 需重启组件和 IM |
| redis/zookeeper 相关 | .env, openim-server/config/config.yaml, chat/config/config.yaml | 需重启组件、IM 和 Chat |
| SECRET | openim-server/config/config.yaml, chat/config/config.yaml | 需重启 IM 和 Chat |

### 6.2 🔄 共用配置项中特殊配置项的修改

特殊配置项：API_OPENIM_PORT/MINIO_PORT/OPENIM_IP/GRAFANA_PORT

1. 修改 `.env` 文件中的特殊配置项
2. 在 **`openim-server/config/config.yaml`** 中按照规则修改配置

```jsx
object:
  apiURL: "http://$OPENIM_IP:$API_OPENIM_PORT"
  minio:
    endpoint: "http://$DOCKER_BRIDGE_GATEWAY:$MINIO_PORT"
    signEndpoint: "http://$OPENIM_IP:$MINIO_PORT"

grafanaUrl: http://$OPENIM_IP:$GRAFANA_PORT
```

1. 在 **`chat/config/config.yaml`** 中按照规则修改配置

```jsx
openIMUrl: "[http://172.28.0.1:](http://127.0.0.1:10002/)$API_OPENIM_PORT"
```

4. 重启 IM 和 Chat

### 6.3 🛠️ 其他配置项的修改

对于 **`.env`**、**`chat/config/config.yaml`** 和 **`openim-server/config/config.yaml`** 中的其他配置项，可以单独修改相应文件中的这些配置项。

## 7. 常见问题

### 7.1 📜 日志查看

日志位置：

- 运行时日志：`logs/OpenIM.log.all.*`
- 启动日志：`_output/logs/openim_*.log`



### 7.2 🚀 启动顺序

启动顺序如下：

- IM 依赖的组件：mongo/redis/kafka/zookeeper/minio
- **IM**
- Chat 依赖的组件：mysql
- **Chat**

### 7.3 🐳 Docker 版本

新版本的 Docker 已将 `docker-compose` 集成为其核心功能，不需单独安装。推荐版本 `23.0.1`。




