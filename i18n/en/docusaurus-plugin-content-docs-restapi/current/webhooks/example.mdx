---
sidebar_position: 2
title: callbackExample
hide_title: true
---

# üõ† Implementing a Chatbot with OpenIM

### **Arief description**

Use the callback mechanism in OpenIM to realize the chatbot Q&A function, i.e. after sending a message to the chatbot (text and image messages are supported), the chatbot will return this message.


## 1.Modify the configuration file
Modify the config/config.yaml configuration in open-im-server by referring to the following template

![PC Web Interface](./assets/config.png)

tips
> url is callback url

> If afterSendSingleMsg.enable is true, the callback is enabled.
 
## 2.Create a chatbot account and designate it as your default friend
1. Log in to the management background, create a chatbot account in the user management of the business system in the management background, and record the **userID** of the account.

2. Add the created chatbot account as a default friend in the registration management of the business system in the administration backend

TipsÔºö
> Login to the administrator's back office with the following password: 

> AccountÔºöchatAdmin 

> PasswordÔºöchatAdmin

## 3. Write the **afterSendSingleMsg** interface.
Reference examples are as follows

tips:
>1„ÄÅYou need to replace the **robotics** in the example with the userID you got in 2.


```Go
func (m *ChatApi) CallbackExample(c *gin.Context) {
	// 1. Handling callbacks after sending a single chat message
	msgInfo, err := handlingCallbackAfterSendMsg(c)
	if err != nil {
		apiresp.GinError(c, err)
		return
	}

	// 2. If the user receiving the message is a customer service bot, return the message.
	// 2.1 UserID of the robot account
	robotics := "robotics"

	// 2.2 ChatRobot account validation and determining if messages are text and images
	if msgInfo.SendID == robotics || msgInfo.RecvID != robotics {
		return
	}
	if msgInfo.ContentType != constant.Picture && msgInfo.ContentType != constant.Text {
		return
	}

	// 2.3 Get administrator token
	adminToken, err := getAdminToken(c)
	if err != nil {
		apiresp.GinError(c, err)
		return
	}

	// 2.4 Get RobotAccount info
	robUser, err := getRobotAccountInfo(c, adminToken.AdminToken, robotics)
	if err != nil {
		apiresp.GinError(c, err)
		return
	}

	// 2.5 Constructing Message Field Contents
	mapStruct, err := contextToMap(c, msgInfo)
	if err != nil {
		apiresp.GinError(c, err)
		return
	}

	// 2.6 Send Message
	err = sendMessage(c, adminToken.ImToken, robotics, msgInfo, robUser, mapStruct)
	if err != nil {
		apiresp.GinError(c, err)
		return
	}
}

```
[For detailed code, please refer to](https://github.com/luhaoling/chat/blob/logs/internal/api/callbackExample.go)

## 4.Experience the feature
1„ÄÅSuccessful login can send messages and pictures to the chatbot account

![PC Web Interface](./assets/result.png)

