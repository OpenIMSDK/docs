---
title: 'k8s Deployment - To be refined'
sidebar_position: 5
---

# OpenIM Kubernetes Deployment - To Be Refined

OpenIM supports multiple cluster deployment methods, including but not limited to `helm`, `sealos`, and `kustomize`.

Several contributors and previous official versions have provided some reference solutions:

- [k8s-jenkins repository](https://github.com/OpenIMSDK/k8s-jenkins)
- [open-im-server-k8s-deploy repository](https://github.com/openimsdk/open-im-server-k8s-deploy)
- [openim-charts repository](https://github.com/OpenIMSDK/openim-charts)
- [deploy-openim repository](https://github.com/showurl/deploy-openim)

### Dependency Check

```bash
Kubernetes: >= 1.16.0-0
Helm: >= 3.0
```

### Minimum Configuration

For production environments, the recommended minimum configuration is as follows:

```yaml
CPU: 4
Memory: 8G
Disk: 100G
```

## Configuration File Generation

We have automated the generation of all files, making it optional to generate configuration files for OpenIM. However, if you want to customize the configuration, you can follow these steps:

```bash
$ make init
# Or use the script:
# ./scripts/init-config.sh
```

At this point, the configuration files will be generated under `deployments/openim/config`, and you can modify them as needed.

### Installing Helm

Helm simplifies Kubernetes application deployment and management by providing version control and release management through packaging.

**Using Script:**

```bash
$ curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
```

**Adding Repository:**

```bash
$ helm repo add brigade https://openimsdk.github.io/openim-charts
```

### OpenIM Image Strategy

Automated support includes images from Aliyun, GHCR, and Docker Hub: [Image Documentation](https://github.com/openimsdk/open-im-server/blob/main/docs/conversions/images.md).

**Local Test Build Method:**

```bash
$ make image
```

> This command helps to quickly build the required images locally. For detailed build strategies, refer to the [Build Documentation](https://github.com/openimsdk/open-im-server/blob/main/build/README.md).

## Installation

Browse our Helm-Charts repository and read carefully: [Helm-Charts repository](https://github.com/openimsdk/helm-charts).

If you use the helm charts repository, you can skip the following configuration, but if you only want to use the server and extend it, you can continue:

**Using Helmfile:**

```bash
GO111MODULE=on go get github.com/roboll/helmfile@latest
export MYSQL_ADDRESS=im-mysql
export MYSQL_PORT=3306
export MONGO_ADDRESS=im-mongo
export MONGO_PORT=27017
export REDIS_ADDRESS=im-redis-master
export REDIS_PORT=6379
export KAFKA_ADDRESS=im-kafka
export KAFKA_PORT=9092
export OBJECT_APIURL="https://openim.server.com/api"
export MINIO_ENDPOINT="http://im-minio:9000"
export MINIO_SIGN_ENDPOINT="https://openim.server.com/im-minio-api"

mkdir ./charts/generated-configs
../scripts/genconfig.sh ../scripts/install/environment.sh ./templates/openim.yaml > ./charts/generated-configs/config.yaml
cp ../config/notification.yaml ./charts/generated-configs/notification.yaml
../scripts/genconfig
```

## Cluster Setup Reference

If you already have a Kubernetes cluster, or you wish to build one from scratch, you can skip this step.

For quick startup, I used [sealos](https://github.com/labring/sealos) to rapidly establish a cluster. Sealos is a wrapper around kubeadm:

```bash
SEALOS_VERSION=`curl -s https://api.github.com/repos/labring/sealos/releases/latest | grep -oE '"tag_name": "[^"]+"' | head -n1 | cut -d'"' -f4` && \
  curl -sfL https://raw.githubusercontent.com/labring/sealos/${SEALOS_VERSION}/scripts/install.sh | \
  sh -s ${SEALOS_VERSION} labring/sealos
```

**Supported Versions:**

- Docker: `labring/kubernetes-docker`:(v1.24.0~v1.27.0)
- Containerd: `labring/kubernetes`:(v1.24.0~v1.27.0)

#### Cluster Installation:

Cluster details are as follows:

| Hostname | IP Address | System Info                                                                                                        |
| -------- | ---------- | ------------------------------------------------------------------------------------------------------------------ |
| master01 | 10.0.0.9   | `Linux VM-0-9-ubuntu 5.15.0-76-generic #83-Ubuntu SMP Thu Jun 15 19:16:32 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux` |
| node01   | 10.0.0.4   | Similar to master01                                                                                                |
| node02   | 10.0.0.10  | Similar to master01                                                                                                |

```bash
$ export CLUSTER_USERNAME=ubuntu
$ export CLUSTER_PASSWORD=123456
$ sudo sealos run labring/kubernetes:v1.25.0 labring/helm:v3.8.2 labring/calico:v3.24.1 \
    --masters 10.0.0.9 \
    --nodes 10.0.0.4,10.0.0.10 \
    -u "$CLUSTER_USERNAME" \
    -p "$CLUSTER_PASSWORD"
```

> **Note:** Uninstalling via `kubeadm` does not delete `etcd` and `cni` configurations. These must be manually cleared or removed using `sealos`.
>
> ```bash
> $ sealos reset
> ```

If you are testing locally, you can also use Kind or Minikube, for example, with Kind:

```bash
GO111MODULE="on" go get sigs.k8s.io/kind@v0.11.1
kind create cluster
```
