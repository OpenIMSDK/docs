---
title: 'Source Code Deployment'
sidebar_position: 1
---

# 🛠 Source Code Deployment

## 1. Environment and Component Requirements

For information on server environment, system, and dependencies, refer to [this document](./env-comp).

## 2. Deploying OpenIM Server (IM)

### 2.1 Clone the Repository (Switch to the `release-v3.8` branch)

```bash
git clone https://github.com/openimsdk/open-im-server && cd open-im-server
```

### 2.2 Deploy Components (MongoDB/Redis/Zookeeper/Kafka/MinIO, etc.)

```bash
docker compose up -d
```

### 2.3 Set External IP or Domain Name [Refer to Nginx Configuration](./nginxDomainConfig.mdx)

```bash
Modify the `externalAddress` field in `config/minio.yml` to `http://external_IP:port` or `domain_name`.
Modify `grafanaURL` in `config/openim-api.yml` from `http://127.0.0.1:13000/` to `http://external_IP:port` or `domain_name`.
```

### 2.4 🛠️ Initialization

Before compiling for the first time, execute the following commands:

- For Linux/macOS:

```bash
bash bootstrap.sh
```

- For Windows:

```bash
bootstrap.bat
```

### 2.5 🛠️ Compilation (Linux/Windows/macOS)

```bash
mage
```

### 2.6 🚀 Start/Stop/Check (Linux/Windows/macOS)

```bash
# Start
mage start
# Start in background and collect logs
nohup mage start >> _output/logs/openim.log 2>&1 &
# Stop
mage stop
# Check
mage check
```

### 2.7 Modify Other Configuration Items

Refer to the [configuration README](https://github.com/openimsdk/open-im-server/blob/main/config/README.md).

---

## 3. Deploying App Server (Chat)

### 3.1 Clone the Repository (Switch to the `release-v1.8` branch)

```bash
git clone https://github.com/openimsdk/chat && cd chat
```

### 3.2 🛠️ Initialization

Before compiling for the first time:

- For Linux/macOS:

```bash
bash bootstrap.sh
```

- For Windows:

```bash
bootstrap.bat
```

### 3.3 🛠️ Compilation (Linux/Windows/macOS)

```bash
mage
```

### 3.4 🚀 Start/Stop/Check (Linux/Windows/macOS)

```bash
# Start
mage start
# Start in background and collect logs
nohup mage start >> _output/logs/chat.log 2>&1 &
# Stop
mage stop
# Check
mage check
```

### 3.5 Modify Other Configuration Items

Refer to the [configuration README](https://github.com/openimsdk/chat/blob/main/config/README.md).

---

## Previous Versions (Release v3.6 and Before)

## 2. Deploy OpenIM Server (IM)

### 2.1 📡 Set `OPENIM_IP`

🔔 **You must set `OPENIM_IP`, and it cannot be `127.0.0.1`.**

```bash
# If the server has an external IP
export OPENIM_IP="external IP"

# If only providing internal services
export OPENIM_IP="internal IP"
```

### 2.2 🏗️ Deploy Components (MongoDB/Redis/Zookeeper/Kafka/MinIO, etc.)

```bash
git clone https://github.com/OpenIMSDK/open-im-server && cd open-im-server
# Switch to the release-v3.6 or later release branch
make init && docker compose up -d
```

### 2.3 🛠️ Compilation

```bash
make build
```

### 2.4 🚀 Start/Stop/Check

```bash
# Start
make start
# Stop
make stop
# Check
make check
```

---

## 3. Deploy App Server (Chat)

### 3.1 🏗️ Clone Chat Repository

```bash
# Go back to the previous directory
cd ..
# Clone the repository, switch to the release-v1.6 or later release branch
git clone https://github.com/OpenIMSDK/chat chat && cd chat
```

### 3.2 🛠️ Compilation

```bash
make init
make build
```

### 3.3 🚀 Start/Stop/Check

```bash
# Start
make start
# Stop
make stop
# Check
make check
```

---

## 4. Quick Test

Refer to the [Quick Test](./quickTestServer) documentation for more details.

---

## 5. Admin Panel and Monitoring System

Refer to the [Admin Panel and Monitoring System](./admin) documentation.

---

## 6. Configuration Item Changes

### 6.1 🛠️ Modifying Shared Configuration Items

| Configuration Item | Files to Modify                                                       | Action                           |
| ------------------ | --------------------------------------------------------------------- | -------------------------------- |
| Mongo/Kafka/MinIO  | `.env`, `openim-server/config/config.yaml`                            | Restart components and IM        |
| Redis/Zookeeper    | `.env`, `openim-server/config/config.yaml`, `chat/config/config.yaml` | Restart components, IM, and Chat |
| SECRET             | `openim-server/config/config.yaml`, `chat/config/config.yaml`         | Restart IM and Chat              |

### 6.2 🔄 Modifying Special Shared Configuration Items

Special configuration items: `API_OPENIM_PORT`, `MINIO_PORT`, `OPENIM_IP`, `GRAFANA_PORT`

1. Modify these special configuration items in the `.env` file.
2. Update the settings in **`openim-server/config/config.yaml`** according to the rules:

```yaml
object:
  apiURL: 'http://$OPENIM_IP:$API_OPENIM_PORT'
  minio:
    endpoint: 'http://$DOCKER_BRIDGE_GATEWAY:$MINIO_PORT'
    signEndpoint: 'http://$OPENIM_IP:$MINIO_PORT'

grafanaUrl: http://$OPENIM_IP:$GRAFANA_PORT
```

3. Update the settings in **`chat/config/config.yaml`**:

```yaml
If IM and Chat are not on the same machine, replace `127.0.0.1` with the IP of the IM machine:
openIMUrl: 'http://127.0.0.1:$API_OPENIM_PORT'
```

4. Restart IM and Chat.

### 6.3 🛠️ Modifying Other Configuration Items

For other configuration items in **`.env`**, **`chat/config/config.yaml`**, and **`openim-server/config/config.yaml`**, modify the corresponding files as needed.

### 6.4 Modifying Ports

When modifying any IM-related ports, you must also update the ports in `open-im-server/scripts/install/environment.sh`.

---

## 7. Common Issues

### 7.1 📜 Log Viewing

Log locations:

- Runtime logs: `_output/logs/openim-all*`
- Startup logs: `_output/logs/openim-*.log`

### 7.2 🚀 Startup Order

The startup order is as follows:

1. Components that IM depends on: Mongo/Redis/Kafka/Zookeeper/MinIO, etc.
2. **IM**
3. **Chat**

### 7.3 🐳 Docker Version

Newer versions of Docker have integrated `docker-compose`. Older versions of Docker may not support the gateway feature❌. We recommend upgrading to a newer version, such as `23.0.1`🔝.
