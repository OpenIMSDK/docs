---
title: 'Docker Deployment for OpenIM'
sidebar_position: 3
---

# Environment Setup üåç

- Install Docker with the Compose plugin or docker-compose on your server. For installation details, please visit the [Docker Compose Installation Guide](https://docs.docker.com/compose/install/linux/).

## Clone the Repository üóÇÔ∏è

```bash
git clone https://github.com/openimsdk/openim-docker
```

## Configuration Modifications üîß

- Modify the `.env` file to configure the external IP. If using a domain name, configure [Nginx](./nginxDomainConfig.mdx).

  ```plaintext
  # Set the external access address for the MinIO service (external IP or domain name)
  MINIO_EXTERNAL_ADDRESS="http://external_ip:10005"
  # Set the external access address for the Grafana service (external IP or domain name)
  GRAFANA_URL="http://external_ip:13000/"
  ```

- Other configurations can be found in the comments within the `.env` file.

## Service Startup üöÄ

- To start the services:

```bash
docker compose up -d
```

- To stop the services:

```bash
docker compose down
```

- To view logs:

```bash
docker logs -f openim-server
docker logs -f openim-chat
```

## Quick Experience ‚ö°

For a quick experience with the OpenIM service, refer to the [Quick Test](./quickTestServer).

---

## Previous Versions (Release v3.6 and Before)

---

# üõ† Docker Deployment

## 1. Environment and Component Requirements

Refer to this document for the server environment, system, and storage component requirements: [Environment and Component Requirements](./env-comp).

---

## 2. Docker Deployment

### 2.1 Clone the Repository and Initialize

```bash
git clone https://github.com/openimsdk/openim-docker openim-docker && cd openim-docker && make init
```

üí° **Tips**

> If you didn't clone the repository but downloaded a zip file for `openim-docker`, run **`find ./ -name "*.sh" | xargs chmod +x`** to grant execute permissions to the scripts.

---

### 2.2 Set the OPENIM_IP

üîî **You must set the `OPENIM_IP`, and it cannot be `127.0.0.1`**

```bash
# If the server has an external IP
export OPENIM_IP="external IP"

# If only internal services are provided
export OPENIM_IP="internal IP"
```

---

### 2.3 Start Services and View Logs

```bash
docker compose up -d
docker ps
docker compose logs -f openim-chat
docker compose logs -f openim-server
```

---

## 3. Quick Test

Refer to the [Quick Test](./quickTestServer) documentation for further details.

---

## 4. Admin Panel and Monitoring System

Refer to the [Admin Panel and Monitoring System](./admin) documentation for more details.

---

## 5. Configuration Changes

This project has relatively complex configuration settings. Some settings involve multiple files such as **`.env`**, **`openim-chat/config/config.yaml`**, and **`openim-server/config/config.yaml`**. Configuration changes are explained in two parts: shared configuration changes and other configuration changes.

### 5.1 Shared Configuration Items

These configuration items are shared between **`.env`**, **`openim-chat/config/config.yaml`**, and **`openim-server/config/config.yaml`**:

1. Ports and passwords for MySQL, Mongo, Redis, Kafka, Zookeeper, and MinIO;
2. SECRET;
3. API_OPENIM_PORT;
4. OPENIM_IP;
5. MINIO_PORT;
6. GRAFANA_PORT.

### 5.2 Modification Methods

For modifying the shared configuration items in 5.1, you can choose between two methods:

#### Method 1: Regenerate All Configuration Files

If you need to update the configuration comprehensively, follow these steps:

1. Delete the existing configuration files: delete the **`openim-server/config/config.yaml`** and **`openim-chat/config/config.yaml`** files.
2. Modify the `.env` file: update the relevant settings in the **`.env`** file.
3. Regenerate the configuration and restart the services: run **`docker compose down ; docker compose up -d`** to regenerate the configuration files based on the new settings in the **`.env`** file and restart the services.

#### Method 2: Modify Individual Configuration Files

If you only need to update part of the configuration, follow these steps:

1. Modify the `.env` file: update the relevant settings in the **`.env`** file.
2. Manually update the configuration files: update the corresponding settings in **`openim-server/config/config.yaml`** and **`openim-chat/config/config.yaml`** according to the changes made in the `.env` file.
3. Special variable handling: if you modify **`OPENIM_IP`**, **`API_OPENIM_PORT`**, **`MINIO_PORT`**, or **`GRAFANA_PORT`**, update the following settings in **`openim-server/config/config.yaml`**:

   ```yaml
   object:
     apiURL: 'http://$OPENIM_IP:$API_OPENIM_PORT'
     minio:
       endpoint: 'http://$DOCKER_BRIDGE_GATEWAY:$MINIO_PORT'
       signEndpoint: 'http://$OPENIM_IP:$MINIO_PORT'

   grafanaUrl: http://$OPENIM_IP:$GRAFANA_PORT
   ```

4. Restart the services: run **`docker compose down ; docker compose up -d`** to apply the changes and restart the services.

### 5.3 Modifying Other Configuration Items

For non-shared variables in the **`.env`**, **`openim-chat/config/config.yaml`**, and **`openim-server/config/config.yaml`** files, you can modify these settings individually in the respective files. Run **`docker compose down ; docker compose up -d`** to apply the changes and restart the services.

---

## ‚ùì 6. Common Issues

### 6.1 Able to Send Text Messages, But Unable to Send Images üòï

This might be because the `OPENIM_IP` environment variable was not set before running `docker compose up -d`. Check the startup logs or use the following command to search the logs for "127.0.0.1" to confirm:

```bash
grep "127.0.0.1" openim-server/_output/logs/openim-docker.log
```

#### Solution:

1. Set the `OPENIM_IP` environment variable to your public IP address (or internal IP if only providing internal services):

   ```bash
   export OPENIM_IP="<Public-IP>"
   ```

2. Use the `sed` command to update the `apiURL` and `signEndpoint` settings in the `config.yaml` file to the IP address specified by the `OPENIM_IP` environment variable:

   ```bash
   sed -i -e "s/apiURL: \"http:\/\/127\.0\.0\.1/apiURL: \"http:\/\/${OPENIM_IP}/" \
          -e "s/signEndpoint: \"http:\/\/127\.0\.0\.1/signEndpoint: \"http:\/\/${OPENIM_IP}/" \
          openim-server/config/config.yaml
   ```

After modifying the configuration and restarting the services, you should be able to send images successfully.

### 6.2 About Docker Version üêã

It is strongly recommended to use the `docker compose` command instead of `docker-compose`. Older versions of Docker may not support the gateway feature‚ùå. We recommend upgrading to a newer version, such as `23.0.1`üîù.

### 6.3 Log Viewing üìú

Log locations:

- Runtime logs: `{openim-server, openim-chat}/_output/logs/openim-all.*`
- Startup logs: `{openim-server, openim-chat}/_output/logs/openim-docker.log`
