"use strict";(self.webpackChunkopenim_docs=self.webpackChunkopenim_docs||[]).push([[98112],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>g});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},m="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),m=p(n),u=r,g=m["".concat(s,".").concat(u)]||m[u]||c[u]||i;return n?a.createElement(g,o(o({ref:t},d),{},{components:n})):a.createElement(g,o({ref:t},d))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[m]="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},35149:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>m,contentTitle:()=>p,default:()=>h,frontMatter:()=>s,metadata:()=>d,toc:()=>c});n(67294);var a=n(3905);const r=n.p+"assets/images/admin-a8f308c39b20d55e0c99886a1848349a.jpg";function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const s={title:"Monitoring and Alert System",sidebar_position:6},p=void 0,d={unversionedId:"gettingStarted/admin",id:"gettingStarted/admin",title:"Monitoring and Alert System",description:"Component Description",source:"@site/i18n/en/docusaurus-plugin-content-docs-guides/current/gettingStarted/admin.mdx",sourceDirName:"gettingStarted",slug:"/gettingStarted/admin",permalink:"/guides/gettingStarted/admin",draft:!1,editUrl:"https://github.com/OpenIMSDK/docs/tree/main/docs/guides/gettingStarted/admin.mdx",tags:[],version:"current",lastUpdatedAt:1724419862,formattedLastUpdatedAt:"Aug 23, 2024",sidebarPosition:6,frontMatter:{title:"Monitoring and Alert System",sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"k8s Deployment - To be refined",permalink:"/guides/gettingStarted/k8s-deployment"},next:{title:"Environment and Components",permalink:"/guides/gettingStarted/env-comp"}},m={},c=[{value:"Component Description",id:"component-description",level:2},{value:"Configuration File Description",id:"configuration-file-description",level:2},{value:"Configuration Files and Alerts Description",id:"configuration-files-and-alerts-description",level:2},{value:"Accessing the Admin Panel",id:"accessing-the-admin-panel",level:2},{value:"Accessing Grafana",id:"accessing-grafana",level:2},{value:"Adding Prometheus Data Source",id:"adding-prometheus-data-source",level:2},{value:"Importing the Dashboard",id:"importing-the-dashboard",level:2},{value:"Customizing the Dashboard",id:"customizing-the-dashboard",level:2},{value:"Importing the Node-Exporter Dashboard",id:"importing-the-node-exporter-dashboard",level:2},{value:"Alert Experience",id:"alert-experience",level:2},{value:"Log System",id:"log-system",level:2},{value:"Custom Prometheus Metric Configuration",id:"custom-prometheus-metric-configuration",level:2},{value:"Common Issues",id:"common-issues",level:2}],u={toc:c},g="wrapper";function h(e){var{components:t}=e,s=l(e,["components"]);return(0,a.kt)(g,o(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){i(e,t,n[t])}))}return e}({},u,s),{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"component-description"},"Component Description"),(0,a.kt)("p",null,"When deploying with Docker Compose, the following components will be automatically deployed. If deploying from source code, you will need to manually start the relevant components listed in ",(0,a.kt)("inlineCode",{parentName:"p"},"docker-compose.yaml"),"."),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Component Name"),(0,a.kt)("th",{parentName:"tr",align:null},"Component Description"),(0,a.kt)("th",{parentName:"tr",align:null},"Deployment Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"openim-admin"),(0,a.kt)("td",{parentName:"tr",align:null},"Admin panel, provides monitoring page entry"),(0,a.kt)("td",{parentName:"tr",align:null},"Automatically enabled in both Docker and source code deployments")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"prometheus"),(0,a.kt)("td",{parentName:"tr",align:null},"Monitoring system component used for collecting and storing metric data"),(0,a.kt)("td",{parentName:"tr",align:null},"Automatically enabled in Docker deployments; manual activation required for source code deployments")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"alertmanager"),(0,a.kt)("td",{parentName:"tr",align:null},"Component for managing and sending alerts"),(0,a.kt)("td",{parentName:"tr",align:null},"Automatically enabled in Docker deployments; manual activation required for source code deployments")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"grafana"),(0,a.kt)("td",{parentName:"tr",align:null},"Dashboard component for displaying monitoring data"),(0,a.kt)("td",{parentName:"tr",align:null},"Automatically enabled in Docker deployments; manual activation required for source code deployments")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"node-exporter"),(0,a.kt)("td",{parentName:"tr",align:null},"Component for collecting node (e.g., server) metric data"),(0,a.kt)("td",{parentName:"tr",align:null},"Automatically enabled in Docker deployments; manual activation required for source code deployments")))),(0,a.kt)("h2",{id:"configuration-file-description"},"Configuration File Description"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"File Name"),(0,a.kt)("th",{parentName:"tr",align:null},"File Description"),(0,a.kt)("th",{parentName:"tr",align:null},"Modifications Required"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"config/config.yaml")),(0,a.kt)("td",{parentName:"tr",align:null},"openIM service configuration"),(0,a.kt)("td",{parentName:"tr",align:null},"Set ",(0,a.kt)("inlineCode",{parentName:"td"},"prometheus.enable: true")," to enable Prometheus")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"config/prometheus.yml")),(0,a.kt)("td",{parentName:"tr",align:null},"Prometheus configuration"),(0,a.kt)("td",{parentName:"tr",align:null},"No modifications needed")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"config/instance-down-rules.yml")),(0,a.kt)("td",{parentName:"tr",align:null},"Alert rules"),(0,a.kt)("td",{parentName:"tr",align:null},"Two default rules: ",(0,a.kt)("inlineCode",{parentName:"td"},"instance_down"),", ",(0,a.kt)("inlineCode",{parentName:"td"},"database_insert_failure_alerts"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"config/alertmanager.yml")),(0,a.kt)("td",{parentName:"tr",align:null},"Alert management configuration"),(0,a.kt)("td",{parentName:"tr",align:null},"Configure sender and receiver email information")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"config/email.tmpl")),(0,a.kt)("td",{parentName:"tr",align:null},"Email alert template"),(0,a.kt)("td",{parentName:"tr",align:null},"Default email template, can be customized")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"config/templates/prometheus-dashboard.yaml")),(0,a.kt)("td",{parentName:"tr",align:null},"Custom dashboard template"),(0,a.kt)("td",{parentName:"tr",align:null},"No modifications needed")))),(0,a.kt)("h2",{id:"configuration-files-and-alerts-description"},"Configuration Files and Alerts Description"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"prometheus.yml File Description"),": Primarily used to configure alert rules file paths, alert management service addresses, and IP addresses for collecting monitoring data. Replace all instances of ",(0,a.kt)("inlineCode",{parentName:"p"},"internal_ip")," with your own private IP address, as shown below:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"# Alertmanager configuration\nalerting:\n  alertmanagers:\n    - static_configs:\n        - targets: ['192.168.0.1:19093']\n")),(0,a.kt)("p",{parentName:"li"},"If you need to add alert files, do so under ",(0,a.kt)("inlineCode",{parentName:"p"},"rule_files"),". The default alert file is ",(0,a.kt)("inlineCode",{parentName:"p"},"instance-down-rules.yml"),".")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Email Alert Architecture Diagram"),": The Prometheus component loads the alert rules from the ",(0,a.kt)("inlineCode",{parentName:"p"},"instance-down-rules.yml")," file and sends alerts that meet the conditions to the alertmanager component. The alertmanager component loads the ",(0,a.kt)("inlineCode",{parentName:"p"},"alertmanager.yml")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"email.tmpl")," files, and sends email alerts based on the configured email information and email template."),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("img",{alt:"PC Web Interface",src:n(46345).Z,width:"1086",height:"304"}))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"instance-down-rules.yaml File Description"),": By default, two email alert rules are implemented: ",(0,a.kt)("inlineCode",{parentName:"p"},"instance_down")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"database_insert_failure_alerts"),". You can add more alert rules by editing the ",(0,a.kt)("inlineCode",{parentName:"p"},"instance-down-rules.yml")," file."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"groups:\n  - name: instance_down # Rule 1: Trigger an alert if a monitored module is down for more than one minute\n    rules:\n      - alert: InstanceDown\n        expr: up == 0\n        for: 1m\n        labels:\n          severity: critical\n        annotations:\n          summary: 'Instance {{ $labels.instance }} down'\n          description: '{{ $labels.instance }} of job {{ $labels.job }} has been down for more than 1 minute.'\n\n  - name: database_insert_failure_alerts # Rule 2: Trigger an alert if `msg_insert_redis_failed_total` or `msg_insert_mongo_failed_total` increases\n    rules:\n      - alert: DatabaseInsertFailed\n        expr: (increase(msg_insert_redis_failed_total[5m]) > 0) or (increase(msg_insert_mongo_failed_total[5m]) > 0)\n        for: 1m\n        labels:\n          severity: critical\n        annotations:\n          summary: 'Increase in MsgInsertRedisFailedCounter or MsgInsertMongoFailedCounter detected'\n          description: 'Either MsgInsertRedisFailedCounter or MsgInsertMongoFailedCounter has increased in the last 5 minutes, indicating failures in message insert operations to Redis or MongoDB, possibly due to a crash.'\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"alertmanager.yml File Description"),": Modify the sender and receiver email configurations to receive alert notifications. To set up alerts through DingTalk, WeChat, or other methods, you will need to modify the ",(0,a.kt)("inlineCode",{parentName:"p"},"alertmanager.yml")," file. For more details, refer to the official documentation of the alert management module: ",(0,a.kt)("a",{parentName:"p",href:"https://prometheus.io/docs/alerting/latest/alertmanager/"},"https://prometheus.io/docs/alerting/latest/alertmanager/")),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"global:\n  resolve_timeout: 5m\n  smtp_from: alert@openim.io # Sender email address for alerts\n  smtp_smarthost: smtp.163.com:465 # SMTP server address\n  smtp_auth_username: alert@openim.io # Email username, generally the same as the sender email\n  smtp_auth_password: YOURAUTHPASSWORD # Authorization code for the sender email\n  smtp_require_tls: false\n  smtp_hello: openim alert\n\ntemplates:\n  - /etc/alertmanager/email.tmpl # Email template\n\nroute:\n  group_by: ['alertname'] # Alert grouping labels. Alerts with the same label values will be combined into one notification\n  group_wait: 5s # Wait time before sending the first alert notification\n  group_interval: 5s # Interval between sending grouped notifications\n  repeat_interval: 5m # Interval for resending notifications for the same alert. Used to periodically remind recipients of ongoing alerts.\n  receiver: email # Default receiver name\nreceivers:\n  - name: email # Receiver name\n    email_configs:\n      - to: 'alert@example.com' # Recipient email address\n        html: '{{ template \"email.to.html\" . }}'\n        headers: { Subject: '[OPENIM-SERVER]Alarm' } # Email subject\n        send_resolved: true # Whether to send a notification when the alert is resolved\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"email.tmpl Template File Description"),": This file is in HTML format. The alert management module will fill in the variable information and render it into an HTML file to send the email. You can modify it according to your needs:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-tmpl"},' {{ define "email.to.html" }}\n {{ if eq .Status "firing" }}\n     {{ range .Alerts }}\n     \x3c!-- Begin of OpenIM Alert --\x3e\n     <div style="border:1px solid #ccc; padding:10px; margin-bottom:10px;">\n         <h3>OpenIM Alert</h3>\n         <p><strong>Alert Status:</strong> firing</p>\n         <p><strong>Alert Program:</strong> Prometheus Alert</p>\n         <p><strong>Severity Level:</strong> {{ .Labels.severity }}</p>\n         <p><strong>Alert Type:</strong> {{ .Labels.alertname }}</p>\n         <p><strong>Affected Host:</strong> {{ .Labels.instance }}</p>\n         <p><strong>Affected Service:</strong> {{ .Labels.job }}</p>\n         <p><strong>Alert Subject:</strong> {{ .Annotations.summary }}</p>\n         <p><strong>Trigger Time:</strong> {{ .StartsAt.Format "2006-01-02 15:04:05" }}</p>\n     </div>\n     {{ end }}\n {{ else if eq .Status "resolved" }}\n     {{ range .Alerts }}\n     \x3c!-- Begin of OpenIM Alert --\x3e\n     <div style="border:1px solid #ccc; padding:10px; margin-bottom:10px;">\n         <h3>OpenIM Alert</h3>\n         <p><strong>Alert Status:</strong> resolved</p>\n         <p><strong>Alert Program:</strong> Prometheus Alert</p>\n         <p><strong>Severity Level:</strong> {{ .Labels.severity }}</p>\n         <p><strong>Alert Type:</strong> {{ .Labels.alertname }}</p>\n         <p><strong>Affected Host:</strong> {{ .Labels.instance }}</p>\n         <p><strong>Affected Service:</strong> {{ .Labels.job }}</p>\n         <p><strong>Alert Subject:</strong> {{ .Annotations.summary }}</p>\n         <p><strong>Trigger Time:</strong> {{ .StartsAt.Format "2006-01-02 15:04:05" }}</p>\n     </div>\n     {{ end }}\n     \x3c!-- End of OpenIM Alert --\x3e\n {{ end }}\n {{ end }}\n')))),(0,a.kt)("h2",{id:"accessing-the-admin-panel"},"Accessing the Admin Panel"),(0,a.kt)("p",null,"Open a browser and enter ",(0,a.kt)("inlineCode",{parentName:"p"},"http://ip:11002")," to access the admin panel. The IP is the server's ",(0,a.kt)("inlineCode",{parentName:"p"},"OPENIM_IP"),". Ensure your browser can access it. The default username and password are both ",(0,a.kt)("inlineCode",{parentName:"p"},"chatAdmin"),"."),(0,a.kt)("img",{src:r,width:"700",alt:"admin "}),(0,a.kt)("h2",{id:"accessing-grafana"},"Accessing Grafana"),(0,a.kt)("p",null,'First, log in to the admin panel, then click on the "Data Monitoring" menu on the left, and use the default username (',(0,a.kt)("inlineCode",{parentName:"p"},"admin"),") and password (",(0,a.kt)("inlineCode",{parentName:"p"},"admin"),") to log in to Grafana."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"PC Web Interface",src:n(96994).Z,width:"1920",height:"868"})),(0,a.kt)("h2",{id:"adding-prometheus-data-source"},"Adding Prometheus Data Source"),(0,a.kt)("p",null,"As shown below, enter the Prometheus data source URL: ",(0,a.kt)("inlineCode",{parentName:"p"},"http://172.28.0.1:19090")," (19090 is the default Prometheus port) and click"),(0,a.kt)("p",null,'"Save and Test" to save.'),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"PC Web Interface",src:n(16587).Z,width:"2880",height:"1397"})),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"PC Web Interface",src:n(25920).Z,width:"2856",height:"1434"})),(0,a.kt)("h2",{id:"importing-the-dashboard"},"Importing the Dashboard"),(0,a.kt)("p",null,"Click the import button as shown below to import the dashboard."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"dashboard.png",src:n(63983).Z,width:"1917",height:"714"})),(0,a.kt)("p",null,"Copy the content of ",(0,a.kt)("inlineCode",{parentName:"p"},"https://github.com/openimsdk/open-im-server/tree/main/config/grafana-template/Demo.json"),' into the area shown below, then click the "Load" button.'),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"dashboard2",src:n(8386).Z,width:"1512",height:"853"})),(0,a.kt)("p",null,"Select your data source and job, and you will be able to import the metrics information as shown below."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"dashboard3",src:n(9890).Z,width:"1912",height:"860"})),(0,a.kt)("h2",{id:"customizing-the-dashboard"},"Customizing the Dashboard"),(0,a.kt)("p",null,"To create a new dashboard (or modify an existing one), click ",(0,a.kt)("inlineCode",{parentName:"p"},"Add visualization")," to create a new panel."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image-20240718104421411",src:n(13027).Z,width:"1920",height:"781"})),(0,a.kt)("p",null,"Select the specified data source, enter the ",(0,a.kt)("inlineCode",{parentName:"p"},"promQL")," statement, click ",(0,a.kt)("inlineCode",{parentName:"p"},"Run queries"),", and choose the appropriate time range to query the related data."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image-20240718104701595",src:n(30465).Z,width:"1917",height:"803"})),(0,a.kt)("p",null,"If you want to modify the metric name, click ",(0,a.kt)("inlineCode",{parentName:"p"},"Options"),", click ",(0,a.kt)("inlineCode",{parentName:"p"},"Legend"),", choose ",(0,a.kt)("inlineCode",{parentName:"p"},"Custom"),", and enter the corresponding expression."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image-20240718105008942",src:n(16097).Z,width:"1343",height:"755"})),(0,a.kt)("p",null,"On the right side, you can modify the panel's title, description, and chart type, and select the appropriate settings based on your needs."),(0,a.kt)("p",null,"After the modifications, click the ",(0,a.kt)("strong",{parentName:"p"},"Apply")," button in the upper-right corner to save the panel. Once the dashboard editing is complete, click Save."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image-20240718105207437",src:n(80749).Z,width:"1579",height:"437"})),(0,a.kt)("h2",{id:"importing-the-node-exporter-dashboard"},"Importing the Node-Exporter Dashboard"),(0,a.kt)("p",null,"Enter ",(0,a.kt)("inlineCode",{parentName:"p"},"1860")," to import the node-exporter dashboard, or visit the official Grafana website (",(0,a.kt)("a",{parentName:"p",href:"https://grafana.com/grafana/dashboards/"},"https://grafana.com/grafana/dashboards/"),") to find other node-exporter dashboard views."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"PC Web Interface",src:n(28132).Z,width:"1120",height:"790"})),(0,a.kt)("p",null,"Here is an example of node-exporter metric information:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"PC Web Interface",src:n(24846).Z,width:"1913",height:"793"})),(0,a.kt)("h2",{id:"alert-experience"},"Alert Experience"),(0,a.kt)("p",null,"You can manually trigger the ",(0,a.kt)("inlineCode",{parentName:"p"},"instance_down")," alert rule. If you are deploying openIM from source code, execute the ",(0,a.kt)("inlineCode",{parentName:"p"},"make stop")," command to stop the ",(0,a.kt)("inlineCode",{parentName:"p"},"openim-server")," service, wait more than 5 minutes, and you will receive an alert email similar to the one below:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"PC Web Interface",src:n(81836).Z,width:"775",height:"682"})),(0,a.kt)("h2",{id:"log-system"},"Log System"),(0,a.kt)("p",null,"If OpenIM services are deployed in a Kubernetes environment using Helm charts, you can view all OpenIM service logs through Grafana. Currently, the binary and Docker deployments do not include the Loki log collection component. To experience Loki log collection functionality, deploy using Helm charts. For more details, visit: ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/openimsdk/helm-charts/blob/main/docs/user-guide-zh.md"},"https://github.com/openimsdk/helm-charts/blob/main/docs/user-guide-zh.md")),(0,a.kt)("h2",{id:"custom-prometheus-metric-configuration"},"Custom Prometheus Metric Configuration"),(0,a.kt)("p",null,"Initialize the corresponding type of metrics in the ",(0,a.kt)("inlineCode",{parentName:"p"},"pkg/common/prommetrics")," directory of the source code and call the ",(0,a.kt)("inlineCode",{parentName:"p"},"Init()")," function for registration."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'const commonPath = "/metrics"\nvar rpcCounter = prometheus.NewCounterVec(\n    prometheus.CounterOpts{\n        Name: "rpc_count",\n        Help: "Total number of RPC calls",\n    },\n    []string{"name", "path", "code"},\n)\n\nfunc RpcInit(cs []prometheus.Collector, prometheusPort int) error {\n    reg := prometheus.NewRegistry()\n    cs = append(append(\n        baseCollector,\n        rpcCounter,\n    ), cs...)\n    return Init(reg, prometheusPort, commonPath, promhttp.HandlerFor(reg, promhttp.HandlerOpts{Registry: reg}), cs...)\n}\n')),(0,a.kt)("p",null,"In the program startup process, initialization must be started in ",(0,a.kt)("strong",{parentName:"p"},"a separate goroutine"),", and after initialization, the service will run and expose the data collection port."),(0,a.kt)("p",null,"Maintain the metrics in the appropriate location within the code:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'rpcCounter.With(prometheus.Labels{"name": name, "path": path, "code": strconv.Itoa(code)}).Inc()\n')),(0,a.kt)("p",null,"To query the metrics in ",(0,a.kt)("inlineCode",{parentName:"p"},"prometheus")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"grafana"),", enter the following ",(0,a.kt)("inlineCode",{parentName:"p"},"promQL")," query:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-promQL"},"rpc_count\n")),(0,a.kt)("p",null,"This will allow you to view the metric information."),(0,a.kt)("h2",{id:"common-issues"},"Common Issues"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"After running ",(0,a.kt)("inlineCode",{parentName:"p"},"docker compose up -d"),", the ",(0,a.kt)("inlineCode",{parentName:"p"},"prometheus")," container keeps restarting."),(0,a.kt)("p",{parentName:"li"},"If the Prometheus container fails to start, it is usually due to two reasons:"),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"The private IP was not configured in ",(0,a.kt)("inlineCode",{parentName:"li"},"prometheus.yml"),"."),(0,a.kt)("li",{parentName:"ol"},"There may be permission issues when starting the ",(0,a.kt)("inlineCode",{parentName:"li"},"prometheus")," container for the first time. Run ",(0,a.kt)("inlineCode",{parentName:"li"},"chmod -R 777 components")," in the ",(0,a.kt)("inlineCode",{parentName:"li"},"open-im-server")," project directory and restart the container.")))))}h.isMDXComponent=!0},46345:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/alert2-d82df995fc7f9cf2a8462a6ed18bab5a.png"},81836:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/alert6-6524d6c82941769762152a11726c7834.png"},63983:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/dashboard-bab5c385a6dbac9f919f494a94e2a49a.png"},8386:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/dashboard2-249cfe565b44bbf0eb8924889d858248.png"},9890:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/dashboard3-277e7f05ed345b5b6c869324aec5d34f.png"},28132:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/dashboard4-f79d3516a843e6b86da396a9744beb7d.png"},24846:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/dashboard5-9db1fd21b30ff25567bb80788c0e8071.png"},13027:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/dashboard6-d7da89a8abf4c85361f38725796d947e.png"},30465:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/dashboard7-62d6d7349ea2702e9ad35d980e52e41d.png"},16097:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/dashboard8-8595772926d2a45aca9eb03fc3be5905.png"},80749:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/dashboard9-fffb1145d0112f8013b39265138e7a3c.png"},16587:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/database-8ebb85b286a5e7509f08fc18aadac189.png"},25920:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/database2-6dc1ae4114d3282c1de06e2dcbd176e4.png"},96994:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/login1-278e0f0b8e78be0dedab061ee7a60ab0.png"}}]);