"use strict";(self.webpackChunkopenim_docs=self.webpackChunkopenim_docs||[]).push([[39432],{3905:(e,n,t)=>{t.d(n,{Zo:()=>l,kt:()=>u});var r=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=r.createContext({}),d=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},l=function(e){var n=d(e.components);return r.createElement(s.Provider,{value:n},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},_=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,l=p(e,["components","mdxType","originalType","parentName"]),c=d(t),_=a,u=c["".concat(s,".").concat(_)]||c[_]||m[_]||o;return t?r.createElement(u,i(i({ref:n},l),{},{components:t})):r.createElement(u,i({ref:n},l))}));function u(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=_;var p={};for(var s in n)hasOwnProperty.call(n,s)&&(p[s]=n[s]);p.originalType=e,p[c]="string"==typeof e?e:a,i[1]=p;for(var d=2;d<o;d++)i[d]=t[d];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}_.displayName="MDXCreateElement"},12179:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>p,metadata:()=>d,toc:()=>c});t(67294);var r=t(3905);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})),e}function i(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}const p={},s="Nginx Domain Configuration",d={unversionedId:"gettingStarted/nginxDomainConfig",id:"gettingStarted/nginxDomainConfig",title:"Nginx Domain Configuration",description:"1. Prerequisites \ud83d\udee0\ufe0f",source:"@site/i18n/en/docusaurus-plugin-content-docs-guides/current/gettingStarted/nginxDomainConfig.mdx",sourceDirName:"gettingStarted",slug:"/gettingStarted/nginxDomainConfig",permalink:"/guides/gettingStarted/nginxDomainConfig",draft:!1,editUrl:"https://github.com/OpenIMSDK/docs/tree/main/docs/guides/gettingStarted/nginxDomainConfig.mdx",tags:[],version:"current",lastUpdatedAt:1724419862,formattedLastUpdatedAt:"Aug 23, 2024",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"oimws Deployment - Planned for Deprecation",permalink:"/guides/gettingStarted/jssdk"},next:{title:"Stress Test Report",permalink:"/guides/pressure_test"}},l={},c=[{value:"1. Prerequisites \ud83d\udee0\ufe0f",id:"1-prerequisites-\ufe0f",level:2},{value:"2. Domain Configuration Template \ud83d\udcdd",id:"2-domain-configuration-template-",level:2},{value:"3. MinIO Configuration \ud83d\uddc4\ufe0f",id:"3-minio-configuration-\ufe0f",level:2},{value:"4. Start Nginx \ud83d\ude80",id:"4-start-nginx-",level:2},{value:"5. Access Verification \ud83d\udd0d",id:"5-access-verification-",level:2}],m={toc:c},_="wrapper";function u(e){var{components:n}=e,t=i(e,["components"]);return(0,r.kt)(_,o(function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){a(e,n,t[n])}))}return e}({},m,t),{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"nginx-domain-configuration"},"Nginx Domain Configuration"),(0,r.kt)("h2",{id:"1-prerequisites-\ufe0f"},"1. Prerequisites \ud83d\udee0\ufe0f"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"open-im-server")," and ",(0,r.kt)("strong",{parentName:"li"},"chat")," have been successfully started."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Nginx")," is installed with SSL modules enabled."),(0,r.kt)("li",{parentName:"ul"},"Two domains and their SSL certificates have been successfully obtained, e.g., ",(0,r.kt)("inlineCode",{parentName:"li"},"web.xx.xx")," (for the IM server and Web client) and ",(0,r.kt)("inlineCode",{parentName:"li"},"admin.xx.xx")," (for the admin panel)."),(0,r.kt)("li",{parentName:"ul"},"Ports 443 and 80 are open.")),(0,r.kt)("h2",{id:"2-domain-configuration-template-"},"2. Domain Configuration Template \ud83d\udcdd"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\ud83d\ude80 ",(0,r.kt)("strong",{parentName:"p"},"Tip"),": Be sure to replace the actual domain names, SSL certificate paths, and SSL keys with your own values.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-nginx"},'# open-im-server and chat deployment addresses and ports\nupstream msg_gateway {\n    # IM Message server address. Multiple addresses can be specified based on deployment\n    server 127.0.0.1:10001;\n}\nupstream im_api {\n    # IM Group user API server address. Multiple addresses can be specified based on deployment\n    server 127.0.0.1:10002;\n}\nupstream im_chat_api {\n    # IM Business version login and registration server address. Multiple addresses can be specified based on deployment\n    server 127.0.0.1:10008;\n}\nupstream im_admin_api {\n    # Admin address for the commercial version. Multiple units can be specified based on deployment\n    server 127.0.0.1:10009;\n}\nupstream minio_s3_2 {\n    # Minio address. Multiple modules can be assigned based on deployment\n    server 127.0.0.1:10005;\n}\nupstream pc_web {\n    # PC web address\n    server 127.0.0.1:11001;\n}\nupstream openim_admin {\n    # Admin backend address\n    server 127.0.0.1:11002;\n}\n\n# Example domain configuration for "web.xx.xx"\nserver {\n    listen 443 ssl; # Listen on port 443\n    server_name web.xx.xx;  # Your domain name\n    # SSL certificate paths\n    ssl_certificate /usr/local/nginx/conf/ssh/web.xx.xx_bundle.pem;\n    ssl_certificate_key /usr/local/nginx/conf/ssh/web.xx.xx.key;\n\n    # Enable gzip compression\n    gzip on;\n    gzip_min_length 1k;\n    gzip_buffers 4 16k;\n    gzip_comp_level 2;\n    gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png application/wasm;\n    gzip_vary off;\n    gzip_disable "MSIE [1-6]\\.";\n\n    default_type application/wasm;\n\n    # Proxy configuration for the root path\n    location / {\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection "Upgrade";\n        proxy_set_header X-real-ip $remote_addr;\n        proxy_set_header X-Forwarded-For $remote_addr;\n        proxy_pass http://pc_web/;\n    }\n\n    # Proxy configuration for msg_gateway\n    location /msg_gateway {\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection "Upgrade";\n        proxy_set_header X-real-ip $remote_addr;\n        proxy_set_header X-Forwarded-For $remote_addr;\n        proxy_pass http://msg_gateway/;\n    }\n\n    # Proxy configuration for the API\n    location ^~/api/ {\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection "Upgrade";\n        proxy_set_header X-real-ip $remote_addr;\n        proxy_set_header X-Forwarded-For $remote_addr;\n        proxy_set_header X-Request-Api $scheme://$host/api;\n        proxy_pass http://im_api/;\n    }\n\n    # Proxy configuration for chat\n    location ^~/chat/ {\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection "Upgrade";\n        proxy_set_header X-real-ip $remote_addr;\n        proxy_set_header X-Forwarded-For $remote_addr;\n        proxy_pass http://im_chat_api/;\n    }\n\n    # Proxy configuration for MinIO API\n    location ^~/im-minio-api/ {\n        proxy_set_header Host $http_host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_connect_timeout 300;\n        proxy_http_version 1.1;\n        proxy_set_header Connection "";\n        chunked_transfer_encoding off;\n        proxy_pass http://minio_s3_2/;\n    }\n}\n\n# Example domain configuration for "admin.xx.xx"\nserver {\n    listen 443 ssl; # Listening on port 443\n    server_name admin.xx.xx;  # Your admin domain name\n    # SSL certificate paths\n    ssl_certificate /usr/local/nginx/conf/ssh/admin.xx.xx_bundle.pem;\n    ssl_certificate_key /usr/local/nginx/conf/ssh/admin.xx.xx.key;\n\n    # Enable gzip compression\n    gzip on;\n    gzip_min_length 1k;\n    gzip_buffers 4 16k;\n    gzip_comp_level 2;\n    gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png application/wasm;\n    gzip_vary off;\n    gzip_disable "MSIE [1-6]\\.";\n\n    default_type application/wasm;\n\n    # Proxy configuration for the root path\n    location / {\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection "Upgrade";\n        proxy_set_header X-real-ip $remote_addr;\n        proxy_set_header X-Forwarded-For $remote_addr;\n        proxy_pass http://openim_admin/;\n    }\n\n    # Proxy configuration for msg_gateway\n    location /msg_gateway {\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection "Upgrade";\n        proxy_set_header X-real-ip $remote_addr;\n        proxy_set_header X-Forwarded-For $remote_addr;\n        proxy_pass http://msg_gateway/;\n    }\n\n    # Proxy configuration for the API\n    location ^~/api/ {\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection "Upgrade";\n        proxy_set_header X-real-ip $remote_addr;\n        proxy_set_header X-Forwarded-For $remote_addr;\n        proxy_set_header X-Request-Api $scheme://$host/api;\n        proxy_pass http://im_api/;\n    }\n\n    # Proxy configuration for chat\n    location ^~/chat/ {\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection "Upgrade";\n        proxy_set_header X-real-ip $remote_addr;\n        proxy_set_header X-Forwarded-For $remote_addr;\n        proxy_pass http://im_chat_api/;\n    }\n\n    # Proxy configuration for the admin backend\n    location ^~/complete_admin/ {\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection "Upgrade";\n        proxy_set_header X-real-ip $remote_addr;\n        proxy_set_header X-Forwarded-For $remote_addr;\n        proxy_pass http://im_admin_api/;\n    }\n}\n\n# HTTP to HTTPS redirection\nserver {\n    listen 80;\n    server_name web.xx.xx;\n    rewrite ^(.*)$ https://$host$1 permanent;\n}\n')),(0,r.kt)("h2",{id:"3-minio-configuration-\ufe0f"},"3. MinIO Configuration \ud83d\uddc4\ufe0f"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Source Code Deployment"),": Modify the ",(0,r.kt)("inlineCode",{parentName:"li"},"externalAddress")," in the ",(0,r.kt)("inlineCode",{parentName:"li"},"config/minio.yml")," file to ",(0,r.kt)("inlineCode",{parentName:"li"},'"https://web.xx.xx/im-minio-api"'),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Docker Deployment"),": Modify the ",(0,r.kt)("inlineCode",{parentName:"li"},"MINIO_EXTERNAL_ADDRESS")," in the ",(0,r.kt)("inlineCode",{parentName:"li"},".env")," file to ",(0,r.kt)("inlineCode",{parentName:"li"},'"https://web.xx.xx/im-minio-api"'),".")),(0,r.kt)("h2",{id:"4-start-nginx-"},"4. Start Nginx \ud83d\ude80"),(0,r.kt)("p",null,"Run the command ",(0,r.kt)("inlineCode",{parentName:"p"},"nginx -s reload")," to reload the Nginx configuration and apply the new domain settings."),(0,r.kt)("h2",{id:"5-access-verification-"},"5. Access Verification \ud83d\udd0d"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Access the IM web client: ",(0,r.kt)("inlineCode",{parentName:"li"},"https://web.xx.xx")),(0,r.kt)("li",{parentName:"ul"},"Access the admin panel: ",(0,r.kt)("inlineCode",{parentName:"li"},"https://admin.xx.xx"))))}u.isMDXComponent=!0}}]);